<!doctype html>

<html>

  <head>
    <title>Classless playground</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chance/0.5.6/chance.js"></script>
    <link rel="stylesheet" id="theme">
  </head>

  <body></body>

  <script>
    $.get('template.html', function (html) {
      var u = $(html)
      u.find('*').each(function () {
        var t = $(this)
        var tagName = this.tagName.toLowerCase()

        if (!t.children().length) {
          if (tagName in fillings) {
            var fillingType = fillings[tagName]
            if (Array.isArray(fillingType)) {
              fillingType = chance.pick(fillingType)
            }

            t.append(chance[fillingType]())
          }
          else if (tagName == 'img') {
            if (chance.d4() > 2) {
              t.attr('src', 'http://lorempixel.com/'+chance.natural({min: 100, max: 700}) +'/'+chance.natural({min: 100, max: 700})+'/')
            }
            else {
              t.remove()
            }
          }
        }
      })

      $('body').append(u)
    })

    var fillings = {
      'div': 'paragraph',
      'time': ['sentence', 'word'],
      'p': ['sentence', 'paragraph'],
      'li': ['sentence', 'word'],
      'a': 'word',
      'h1': ['sentence', 'word'],
      'h2': ['sentence', 'word'],
      'h3': ['sentence', 'word'],
    }
  </script>
  <script>
    $('<div>')
      .attr('id', 'play')
      .css({border: '2px dotted black', background: 'white'})
      .css({width: '200px'})
      .css({position: 'fixed', right: '22px', top: '15px', 'z-index': 1000})
      .append(
        $('<div>')
          .css({padding: '10px'})
          .append(
            $('<strong>').text('THEME')
          )
          .append(
            $('<input>')
              .attr('placeholder', 'Paste a Classless CSS theme URL here')
              .val('')
              .on('input', function () {
                var url = $(this).val()
                if (url.substr(0, 4) != 'http') {
                  // just the name of the theme, complete the url
                  url = 'http://rawgit.com/fiatjaf/classless/gh-pages/themes/' + url + '.css'
                }
                else if (url.indexOf('github') != -1) {
                  // github-hosted, replace with rawgit
                  url = url.replace(/https?:\/\/[^\/]+\//, 'http://rawgit.com/')
                }

                $('#theme').attr('href', url)
              })
          )
      )
      .append(
        $('<div>')
          .css({padding: '10px'})
          .append(
            $('<strong>').text('EXAMPLE TEMPLATES')
          )
          .append((function () {
            var ul = $('<ul>').css({padding: '0'})
            var scenarios = [
              'list-of-posts-with-header',
              'list-of-posts',
              'card-with-checklists',
              'post-with-checklists',
              'card-with-header-image',
            ]
            scenarios.forEach(function (name) {
              var url = 'http://rawgit.com/fiatjaf/classless/gh-pages/scenarios/' + name + '.html'
              $('<li>')
                .append(
                  (function (scenarioURL) {
                    return $('<button>')
                      .on('click', function () {
                        $.get(scenarioURL, function (html) {
                          $('#play').appendTo('head')
                          $('body').html(html)
                          $('#play').appendTo('body')
                        })
                        return false
                      })
                      .text(name)
                  })(url)
                )
                .css({'list-style': 'none', padding: '7px'})
                .appendTo(ul)
            })
            ul.append(
              $('<input>')
                .attr('placeholder', 'Paste a classless URL here to test with this theme')
                .val('')
                .on('input', function () {
                  var scenarioURL = $(this).val()

                  // test URL
                  var pattern = new RegExp('^(https?:\\/\\/)'+ // protocol
                    '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+ // domain name
                    '((\\d{1,3}\\.){3}\\d{1,3}))'+ // OR ip (v4) address
                    '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ // port and path
                    '(\\?[;&a-z\\d%_.~+=-]*)?'+ // query string
                    '(\\#[-a-z\\d_]*)?$','i'); // fragment locator
                  if (!pattern.test(scenarioURL)) {
                    return
                  }

                  if (scenarioURL.indexOf('github') != -1) {
                    // github-hosted, replace with rawgit
                    scenarioURL = scenarioURL.replace(/https?:\/\/[^\/]+\//, 'http://rawgit.com/')
                  }

                  $.get(scenarioURL, function (html) {
                    $('#play').appendTo('head')
                    $('body').html(html)
                    $('#play').appendTo('body')
                  })
                })
            )

            return ul
          })())
      )
      .appendTo('body')
  </script>

</html>
